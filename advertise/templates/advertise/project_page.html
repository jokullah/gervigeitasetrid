{% extends "base.html" %}
{% load wagtailcore_tags i18n %}

{% block body_class %}template-projectpage{% endblock %}

{% block content %}
<div class="project-detail">
  <header class="project-header">
    <h1>{{ page.title }}</h1>
    
    <div class="project-header-meta">
      {% if page.company_name %}
        <div class="project-meta-item">
          <span class="project-meta-label">{% trans "Fyrirt√¶ki" %}:</span>
          <span class="project-leader">{{ page.company_name }}</span>
        </div>
      {% endif %}
      
      {% comment %} Show funding info to everyone {% endcomment %}
      {% if page.is_funded %}
        <div class="project-meta-item">
          <span class="project-meta-label">{% trans "Fj√°rm√∂gnun" %}:</span>
          <span class="project-funded">
            {% trans "Fj√°rmagna√∞ verkefni" %}
            {% if page.funding_amount %}
              ({{ page.funding_amount|floatformat:0 }} ISK)
            {% endif %}
          </span>
        </div>
      {% endif %}
      
      {% if page.leidbeinendur.all %}
        <div class="project-meta-item">
          <span class="project-meta-label">{% trans "Lei√∞beinendur" %}:</span>
          <span class="project-leader">
            {% for item in leidbeinendur_with_pages %}
              {% if item.person_page %}
                <a href="{% pageurl item.person_page %}" style="color: var(--HI-blar); text-decoration: underline;">
                  {{ item.user.get_full_name|default:item.user.username }}
                </a>
              {% else %}
                {{ item.user.get_full_name|default:item.user.username }}
              {% endif %}{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </span>
        </div>
      {% else %}
        <div class="project-meta-item">
          <span class="project-meta-label">{% trans "Lei√∞beinendur" %}:</span>
          <span>{% trans "Engir lei√∞beinendur skr√°√∞ir" %}</span>
        </div>
      {% endif %}
      
      {% comment %} Show requested advisors ONLY to staff members {% endcomment %}
      {% if request.user.is_authenticated and 'Starfsmenn' in request.user.groups.all|stringformat:'s' %}
        {% if page.requested_advisors.all %}
          <div class="project-meta-item" style="background: var(--Ljosblar); padding: 0.75rem; border-radius: 6px; margin-top: 1rem;">
            <span class="project-meta-label" style="color: var(--HI-blar); font-weight: 600;">
              üéØ {% trans "Fyrirt√¶ki√∞ √≥ska√∞i eftir" %}:
            </span>
            <div style="margin-top: 0.5rem;">
              {% for item in requested_advisors_with_pages %}
                <span class="requested-advisor" style="display: inline-block; background: var(--Hvitur); padding: 0.25rem 0.75rem; border-radius: 20px; margin: 0.25rem 0.25rem 0.25rem 0; border: 1px solid var(--HI-blar);">
                  {% if item.person_page %}
                    <a href="{% pageurl item.person_page %}" style="color: var(--HI-blar); text-decoration: none;">
                      {{ item.user.get_full_name|default:item.user.username }}
                    </a>
                  {% else %}
                    {{ item.user.get_full_name|default:item.user.username }}
                  {% endif %}
                </span>
              {% endfor %}
            </div>
            <small style="color: var(--Dokkgrar); font-style: italic; display: block; margin-top: 0.5rem;">
              {% trans "√ûessar uppl√Ωsingar sj√°st a√∞eins starfsm√∂nnum" %}
            </small>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </header>

  {% comment %}
  <!-- Uncomment this section if you have a featured image field -->
  {% if page.featured_image %}
    <div class="project-featured-image">
      <img src="{{ page.featured_image.url }}" alt="{{ page.title }}">
    </div>
  {% endif %}
  {% endcomment %}

  <div class="project-body-content">
    <div class="rich-text">
      {{ page.description|richtext }}
    </div>
  </div>

  {% if page.other %}
    <div class="project-body-content">
      <h2>{% trans "A√∞rar uppl√Ωsingar" %}</h2>
      <div class="rich-text">
        {{ page.other|richtext }}
      </div>
    </div>
  {% endif %}

  <div class="project-actions" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
  
    {% comment %} Student application button {% endcomment %}
    {% if request.user.is_authenticated and 'Nemandi' in request.user.groups.all|stringformat:'s' %}
      {% if user_application %}
        <span style="display: inline-block; padding: 0.75rem 1.5rem; background: #fff3cd; color: #856404; border-radius: 4px; font-weight: 600;">
          ‚è≥ {% trans "Ums√≥kn send - b√≠√∞ur svars" %}
        </span>
      {% else %}
        <a href="{% url 'advertise:apply_to_project' page.id %}" class="home-hero__cta">
          {% trans "S√¶kja um verkefni" %}
        </a>
      {% endif %}
    {% endif %}
    
    {% comment %} Existing staff actions {% endcomment %}
    {% if request.user.is_authenticated and 'Starfsmenn' in request.user.groups.all|stringformat:'s' %}
      {% if request.user not in page.leidbeinendur.all %}
        <form method="post" action="{% url 'advertise:assign_to_project' page.id %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="home-hero__cta" style="cursor: pointer; border: none; font: inherit;" onclick="return confirm('{% trans "Ertu viss um a√∞ √æ√∫ viljir hengja √æig vi√∞ √æetta verkefni?" %}')">
            {% trans "Hengja vi√∞ verkefni" %}
          </button>
        </form>
      {% else %}
        <div class="project-assigned" style="display: inline-block; margin-right: 1rem;">
          <span class="assigned-indicator" style="display: inline-block; padding: 0.75rem 1.5rem; background: var(--Ljosgraenn); color: var(--Svartur); border-radius: 4px; font-weight: 600;">
            ‚úì {% trans "√û√∫ ert lei√∞beinandi fyrir √æetta verkefni" %}
          </span>
        </div>
        <form method="post" action="{% url 'advertise:unregister_from_project' page.id %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="home-hero__cta" style="cursor: pointer; background-color: #dc3545; border-color: #dc3545; border: none; font: inherit;" onclick="return confirm('{% trans "Ertu viss um a√∞ √æ√∫ viljir draga √æig √∫r √æessu verkefni?" %}')">
            {% trans "Draga √∫r verkefni" %}
          </button>
        </form>
      {% endif %}
    {% endif %}
  </div>
{% endblock %}
