{% extends "base.html" %}
{% load wagtailcore_tags i18n %}

{% block body_class %}template-projectindexpage{% endblock %}

{% block content %}
<div class="container">
  <header class="page-header">
    <h1>{{ page.title }}</h1>
    {% if page.intro %}
      <div class="page-intro">
        {{ page.intro|richtext }}
      </div>
    {% endif %}
    
    {% comment %} Show projects needing advisors to faculty {% endcomment %}
    {% if user_type == 'faculty' and project_stats and project_stats.without_faculty > 0 %}
      <div class="bg-gray-50 p-3 rounded my-4 border-l-4 border-gray-500 text-sm">
        <div class="flex items-center gap-2">
          <span class="text-gray-500"></span>
          <span class="text-gray-700">
            <strong>{{ project_stats.without_faculty }}</strong> verkefni Ã¾urfa leiÃ°beinanda
          </span>
        </div>
      </div>
    {% endif %}
    
    {% comment %} Show message to anonymous users {% endcomment %}
    {% if user_type == 'anonymous' %}
      <div class="bg-red-50 p-4 rounded-md my-4 border-l-4 border-red-500">
        <h3 class="mb-2 text-red-700">ðŸ”’ {% trans "Login Required" %}</h3>
        <p class="m-0 text-red-700">
          {% trans "Please log in to view available projects." %}
        </p>
      </div>
    {% endif %}
  </header>

  <div class="blog-grid">
    {% for proj in projects %}
      <article class="blog-card">
        <a href="{% pageurl proj %}">
          <div class="blog-card__content">
            <h2 class="blog-card__title">{{ proj.title }}</h2>
            
            <div class="blog-card__meta">
              {% if proj.company_name %}
                <span class="project-company">{{ proj.company_name }}</span>
              {% endif %}
              
              {% if proj.is_funded %}
                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs ml-2">
                  ðŸ’° {% trans "Funded" %}
                </span>
              {% endif %}
              
              {% comment %} Show faculty assignment status to faculty {% endcomment %}
              {% if user_type == 'faculty' %}
                {% if proj.has_faculty_assigned %}
                  <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs ml-2">
                    âœ“ {% trans "MeÃ° leiÃ°beinanda" %}
                  </span>
                {% else %}
                  <span class="bg-orange-100 text-orange-600 px-2 py-1 rounded-full text-xs ml-2">
                    {% trans "Ãžarf leiÃ°beinanda" %}
                  </span>
                {% endif %}
              {% endif %}
            </div>
            
            <div class="blog-card__excerpt">
              <div class="rich-text">
                {{ proj.description|richtext|truncatewords_html:25 }}
              </div>
            </div>
          </div>
        </a>
      </article>
    {% empty %}
      <div class="project-empty">
        {% if user_type == 'student' %}
          <p>{% trans "No projects with assigned faculty advisors are currently available. Check back later!" %}</p>
        {% elif user_type == 'faculty' %}
          <p>{% trans "No projects have been published yet." %}</p>
        {% elif user_type == 'anonymous' %}
          <p>{% trans "Please log in to view available projects." %}</p>
        {% else %}
          <p>{% trans "Engin verkefni aÃ° svo stÃ¶ddu." %}</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}